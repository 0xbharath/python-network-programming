<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Bharath(yamakira_)">
  
  <title>SSH - Python Network programming</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "SSH";
    var mkdocs_page_input_path = "protocols/ssh.md";
    var mkdocs_page_url = "/protocols/ssh/index.html";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../index.html" class="icon icon-home"> Python Network programming</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <ul class="subnav">
    <li><span>Network Programming in Python</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../index.html">Course overview</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../workshop_intro/license/index.html">License & Attributions</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../workshop_intro/bigger_picture/index.html">Bigger picture</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../workshop_intro/speakers/index.html">Speakers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../workshop_intro/workshop_settings/index.html">Workshop settings</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Networking</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../networking/layers/index.html">Layers</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Socket Interface</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../sockets/socket_interface/index.html">Socket interface</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Protocols</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dns/index.html">DNS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../telnet/index.html">Telnet</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="index.html">SSH</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#ssh-the-secure-shell">SSH: The Secure Shell</a></li>
                
                    <li><a class="toctree-l4" href="#ssh-overview">SSH Overview</a></li>
                
                    <li><a class="toctree-l4" href="#ssh-connection">SSH connection</a></li>
                
                    <li><a class="toctree-l4" href="#paramiko">paramiko</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../ftp/index.html">FTP</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Misc Networking libraries</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../libraries/netaddr/index.html">netaddr</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../libraries/netifaces/index.html">netifaces</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Exercises</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../exercises/exercises/index.html">Basic exercises</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../exercises/logpuzzle/index.html">Log puzzle</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Epilogue</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../epilogue/feedback/index.html">Feedback & Credits</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Python Network programming</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>Protocols &raquo;</li>
        
      
    
    <li>SSH</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/yamakira/python-network-programming" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="ssh-the-secure-shell">SSH: The Secure Shell</h1>
<table>
<thead>
<tr>
<th>SSH protocol</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Purpose</strong></td>
<td>Secure remote shell, file transfer, port forwarding</td>
</tr>
<tr>
<td><strong>Standard</strong></td>
<td>RFC 4250–4256</td>
</tr>
<tr>
<td><strong>Runs atop</strong></td>
<td>TCP/IP</td>
</tr>
<tr>
<td><strong>Port number</strong></td>
<td>22</td>
</tr>
<tr>
<td><strong>Libraries</strong></td>
<td>pexpect, pxssh, <strong>paramiko</strong></td>
</tr>
<tr>
<td><strong>Exceptions</strong></td>
<td>socket.error, socket.gaierror, paramiko.SSHException</td>
</tr>
</tbody>
</table>
<h2 id="ssh-overview">SSH Overview</h2>
<ul>
<li>SSH protocol is one of the best-known examples of a secure, encrypted protocol.</li>
<li>SSH is descended from the &lsquo;r&rsquo;-family of protocols(rlogin, rsh, and rcp).</li>
<li>SSH preserved all the great features of the early remote-shell protocol added wit hsecurity, encryption and efficient multiplexing.</li>
</ul>
<h3 id="multiplexing">Multiplexing</h3>
<p>UDP and TCP use the concept of port numbers, let&rsquo;s several different applications run on a machine over single IP. IP protocol has no clue about the different applications running at transport layer.</p>
<p>SSH is a sophisticated protocol that implements its own multiplexing. SSH has a notion of &lsquo;channels&rsquo;, mutliple channels can run on same SSH socket. Every block of information SSH sends across its socket is labeled with a “channel” identifier so that several conversations can share the socket.</p>
<p>Multiplexing makes sense because the real expense of an SSH connection is setting it up. It&rsquo;s takes a few second of real time to setup an SSH connection. So using an SSH connection for as many operations justifies the high intitial expense of setting it up.</p>
<p>Once connected on SSH, you can create several kinds of channels: <br/></p>
<ul>
<li>An interactive shell session, like that supported by Telnet.</li>
<li>An interactive shell session, like that supported by Telnet.</li>
<li>The individual execution of a single command.</li>
<li>A file transfer session letting you browse the remote filesystem.</li>
<li>A port forward that intercepts TCP connections.</li>
</ul>
<h2 id="ssh-connection">SSH connection</h2>
<p>Before automating SSH connections, we&rsquo;ll take a brief look at how SSH conections are established. We&rsquo;ll not delve into SSH protocol internals, we&rsquo;ll only look at the connection flow.</p>
<h3 id="ssh-host-keys">SSH Host keys</h3>
<ul>
<li>
<p>When an SSH client first connects to a remote host, the two exchange temporary public keys that let them encrypt the rest of their conversation without revealing any information to any watching third parties.</p>
</li>
<li>
<p>Then, before the client is willing to divulge any further information, it demands proof of the remote server’s identity. This is to make sure that you don&rsquo;t reveal username or password an attacker who got hold of server&rsquo;s address.</p>
</li>
</ul>
<h3 id="server-identity">Server identity</h3>
<ul>
<li>
<p>One way to deal with identifying machines on the Internet is to deploy your own Public Key Infrastructure(PKI) but using public-key infrastructure would be quite a cumbersome process for something like SSH.</p>
</li>
<li>
<p>An SSH server, when installed, creates its own random public-private key pair that is not signed by anybody. Key distribution can happen on of the two following ways: </p>
<ul>
<li>A system admin writes a <strong>script that gathers up all the host public keys in an organization</strong>, creates an <em>ssh_known_hosts</em> listing them all, and places this file in the /etc/sshd directory on every system in the organization. Once this done, every SSH client will know about every SSH host key before they even connect for the first time.</li>
<li>Another approach is that, rather than knowing the host keys before hand, SSH clients will <strong>save host keys at the moment of first connection</strong>. You actually have no guarantee on this first encounter that you are really talking to the host you think it is. Nevertheless, at least you will be guaranteed that every subsequent connection you ever make to that machine is going to the right place.</li>
</ul>
</li>
</ul>
<p>When you encounter new unfamiliar host, you&rsquo;ll get a message stating authenticity of the host cannot be established and it&rsquo;s left to the user to decide. </p>
<p><img alt="ssh unknown keys" src="../../img/ssh_fail.png" /></p>
<p><img alt="ssh unknown keys" src="../../img/ssh_sucess.png" /></p>
<h2 id="paramiko">paramiko</h2>
<ul>
<li>SSH can be automated by various libraries in Python such as pexpect, pxssh(extra classes/methods around pexpect to deal with SSH), paramiko, fabric etc. </li>
<li>paramiko is a Python third party library that has extensive support for normal SSH operations and it is very trivial to use.</li>
<li>paramiko is  has been ported to java, and is called jaramiko.</li>
</ul>
<h3 id="paramiko-host-key-operations">paramiko - host key operations</h3>
<ul>
<li>paramiko, by default, doesn&rsquo;t load any host key files, so it mandatorily raises an exception for the first host to which you connect because it will not be able to verify its key.</li>
</ul>
<pre><code class="python">&gt;&gt;&gt; import paramiko
&gt;&gt;&gt; client = paramiko.SSHClient()
&gt;&gt;&gt; client.connect('example.com', username='tester')
Traceback (most recent call last):
...
paramiko.ssh_exception.SSHException: Server 'example.com' not found in known_hosts
</code></pre>

<ul>
<li>You can load system and the current user’s known host keys before making connection so that paramiko is aware of them.</li>
</ul>
<pre><code class="python">client.load_system_host_keys()
client.load_host_keys('/home/brandon/.ssh/known_hosts')
client.connect('example.com', username='test')
</code></pre>

<ul>
<li>
<p>paramiko library also lets you choose how you handle unknown hosts.</p>
</li>
<li>
<p>Inside paramiko there are also several decision-making classes that already implement several basic host key options. <br>
            • <strong>paramiko.AutoAddPolicy</strong>: Host keys are automatically added to your user host key store (the file ~/.ssh/known_hosts on Unix systems) when first encountered, but any change in the host key from then on will raise a fatal exception. <br>
            •    <strong>paramiko.RejectPolicy</strong>: Connecting to hosts with unknown keys simply raises an exception. <br>
            •    <strong>paramiko.WarningPolicy</strong>: An unknown host causes a warning to be logged, but the connection is allowed to proceed. <br></p>
</li>
</ul>
<h3 id="ssh-authentication">SSH Authentication</h3>
<p>• You can provide a username and password. <br>
• You can provide a username and then have your client successfully perform a public-key challenge-response. This clever operation manages to prove that you are in possession of a secret “identity” key without actually exposing its contents to the remote system. <br></p>
<ul>
<li>password authentication</li>
</ul>
<pre><code class="python">&gt;&gt;&gt; client.connect('example.com', username='brandon', password=mypass)
</code></pre>

<ul>
<li>Public-key authentication where you use ssh-keygen to create an “identity” key pair (which is typically stored in your ~/.ssh directory) that can be used to authenticate you without a password makes the Python code even easier!</li>
</ul>
<pre><code class="python">&gt;&gt;&gt; client.connect('my.example.com')
</code></pre>

<p>If your identity key file is stored somewhere other than in the normal ~/.ssh/id_rsa file.</p>
<pre><code class="python">&gt;&gt;&gt; client.connect('my.example.com', key_filename='/home/brandon/.ssh/id_sysadmin')
</code></pre>

<h4 id="running-commands">Running commands</h4>
<pre><code class="python">import paramiko, sys, getpass

hostname = sys.argv[1]
username = sys.argv[2]
password = getpass.getpass()


client = paramiko.SSHClient()
client.set_missing_host_key_policy(paramiko.AutoAddPolicy)
client.connect(hostname, username=username, password=password)
    for command in 'echo &quot;Hello, world!&quot;', 'uname', 'uptime':
        stdin, stdout, stderr = client.exec_command(command)
        stdin.close()
        print(repr(stdout.read()))
        stdout.close()
        stderr.close()
client.close
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../ftp/index.html" class="btn btn-neutral float-right" title="FTP">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../telnet/index.html" class="btn btn-neutral" title="Telnet"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/yamakira/python-network-programming" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../telnet/index.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../ftp/index.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
